openapi: 3.0.0
tags:
  - name: policy
  - name: commanding
info:
  title: InsurancePolicy
  version: '1.0'
  contact:
    name: Andrey
    email: andrey@covergo.com
  license:
    name: MIT
  description: API for communicating with Insurance Policy domain
servers:
  - url: 'http://localhost:3000'
paths:
  /policy:
    get:
      summary: Your GET endpoint
      tags:
        - policy
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyStates'
              examples:
                example-1:
                  value:
                    - issued: true
                      duration: null
                      issueDate: '2019-08-24T14:15:22Z'
                      expiryDate: null
                      isExpired: true
                      amount: 0
                      businessTime: '2019-08-24T14:15:22Z'
      operationId: get-policy
      parameters:
        - schema:
            type: string
          in: header
          name: TenantId
          description: Id of the tenant organisation
      security:
        - AccessToken: []
      description: Returns the list of existing policies
    post:
      tags:
        - policy
      summary: ''
      operationId: post-policy
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyId'
              examples:
                example-1:
                  value: string
      description: 'Create a new policy. If successfull, will return id of created policy.'
      parameters: []
  '/policy/{policyId}':
    parameters:
      - schema:
          type: string
        name: policyId
        in: path
        required: true
        description: id of the policy for the operation
    get:
      summary: Your GET endpoint
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyState'
      operationId: get-policy-policyId
      description: Get a specific insurance policy by id
      parameters: []
    post:
      tags:
        - policy
      summary: ''
      operationId: post-policy-policyId
      responses:
        '200':
          description: OK
        '409':
          description: Conflict - policy with such id already exists
      description: 'Create new policy with a specified id. '
    patch:
      summary: ''
      operationId: patch-policy-policyId
      responses:
        '200':
          description: OK
      description: Updates an existing policy
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                Amount:
                  $ref: '#/components/schemas/Amount'
                Duration:
                  $ref: '#/components/schemas/Duration'
          application/xml:
            schema:
              type: object
              properties:
                '':
                  $ref: '#/components/schemas/Duration'
        description: Either amount or Duration must be set
      tags:
        - policy
  '/policy/{policyId}/issuance':
    parameters:
      - schema:
          type: string
        name: policyId
        in: path
        required: true
    get:
      summary: Your GET endpoint
      tags: []
      responses: {}
      operationId: get-policy-policyId-state
      description: 'Get the information about this policy issuance records '
    post:
      summary: ''
      operationId: post-policy-policyId-issuance
      responses:
        '200':
          description: OK
      description: 'Issue target policy. Issue intent id will be generated and returned. '
  '/policy/{policyId}/issuance/{issuanceId}':
    parameters:
      - schema:
          type: string
        name: policyId
        in: path
        required: true
      - schema:
          type: string
        name: issuanceId
        in: path
        required: true
    get:
      summary: Your GET endpoint
      tags: []
      responses: {}
      operationId: get-policy-policyId-issuance-issuanceId
      description: Get status of an issuance request
  '/policy/{policyId}/configurations':
    parameters:
      - schema:
          type: string
        name: policyId
        in: path
        required: true
    get:
      summary: Your GET endpoint
      tags:
        - commanding
      responses: {}
      operationId: get-policy-policyId-configurations
      description: Get information about configurations happend to a policy
    post:
      summary: ''
      operationId: post-policy-policyId-configurations
      responses:
        '200':
          description: OK
      description: Raise new configuration request
  '/policy/{policyId}/configurations/{configurationId}':
    parameters:
      - schema:
          type: string
        name: policyId
        in: path
        required: true
      - schema:
          type: string
        name: configurationId
        in: path
        required: true
    get:
      summary: Your GET endpoint
      tags: []
      responses: {}
      operationId: get-policy-policyId-configurations-configurationId
      description: Get information about a configuration request
  'policy/{policyId}/businesstime/':
    parameters:
      - schema:
          type: string
        name: policyId
        in: path
        required: true
    get:
      summary: Your GET endpoint
      tags: []
      responses: {}
      operationId: get-policy-policyId-businesstime
      description: Get business time of the policy
  '/policy/{policyId}/businesstime/{time}':
    parameters:
      - schema:
          type: string
        name: policyId
        in: path
        required: true
      - schema:
          type: string
        name: time
        in: path
        required: true
    get:
      summary: Your GET endpoint
      tags: []
      responses: {}
      operationId: get-policy-policyId-businesstime-time
      description: Override the current business time of the policy. Requeires additional privileges.
  '/policy/{policyId}/claim':
    parameters:
      - schema:
          type: string
        name: policyId
        in: path
        required: true
    get:
      summary: Your GET endpoint
      tags: []
      responses: {}
      operationId: get-policy-policyId-claims
      description: |
        Get a list of claims submitted for this policy
    post:
      summary: ''
      operationId: post-policy-policyId-claim
      responses:
        '200':
          description: OK
      description: Fill a new claim against policy
  '/policy/{policyId}/claim/{claimId}':
    parameters:
      - schema:
          type: string
        name: policyId
        in: path
        required: true
      - schema:
          type: string
        name: claimId
        in: path
        required: true
    get:
      summary: Your GET endpoint
      tags: []
      responses: {}
      operationId: get-policy-policyId-claim-claimId
      description: Gets information about a specified claim submitted for this policy
    post:
      summary: ''
      operationId: post-policy-policyId-claim-claimId
      responses:
        '200':
          description: OK
      description: Fill a new claim with specified id against the policy.
components:
  schemas:
    PolicyState:
      description: State of an insurance policy
      type: object
      title: ''
      properties:
        issued:
          type: boolean
        duration:
          type: string
          nullable: true
          default: 'null'
          format: date-time
        issueDate:
          type:
            - string
            - 'null'
          minLength: 1
          default: 'null'
          format: date-time
        expiryDate:
          type:
            - string
            - 'null'
          format: date-time
          default: 'null'
        isExpired:
          type: boolean
        amount:
          type: number
        businessTime:
          type: string
          minLength: 1
      required:
        - issued
        - issueDate
        - isExpired
        - amount
        - businessTime
    PolicyStates:
      title: PolicyStates
      type: array
      items:
        $ref: '#/components/schemas/PolicyState'
    PolicyId:
      title: PolicyId
      type: string
      description: 'Id of a Policy, must be unique'
    Amount:
      type: integer
      title: Amount
      description: 'Maximum money amount this policy can cover, in USD cents'
      format: int32
      minimum: 1
    Duration:
      title: Duration
      type: object
      description: 'Duration of the policy, in seconds'
      properties:
        id:
          type: integer
          minimum: 1
          format: int64
  securitySchemes:
    AccessToken:
      name: API Key
      type: apiKey
      in: header
security:
  - AccessToken: []
